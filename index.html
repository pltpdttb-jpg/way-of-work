<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Mastery: Advanced Training</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f8fafc; }
        
        /* Transitions */
        .page-section { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .page-section.active { display: block; opacity: 1; }

        /* Inputs */
        input:focus { outline: none; border-color: #6366f1; ring: 2px; }
        
        /* Validation States */
        .valid-field { border-color: #22c55e !important; background-color: #f0fdf4 !important; color: #15803d; }
        .invalid-field { border-color: #ef4444 !important; background-color: #fef2f2 !important; color: #b91c1c; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-slate-800">

    <header class="bg-white shadow-sm z-20 flex-none border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('home')">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">S</div>
                <h1 class="font-bold text-xl text-indigo-900">Sales<span class="text-indigo-600">Mastery</span> Pro</h1>
            </div>
            <nav class="hidden md:flex gap-6 text-sm font-medium text-gray-500">
                <button onclick="navigateTo('home')" class="hover:text-indigo-600">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                <button onclick="navigateTo('learning')" class="hover:text-indigo-600">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</button>
                <button onclick="navigateTo('training')" class="text-indigo-600">‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô</button>
            </nav>
        </div>
    </header>

    <main class="flex-grow overflow-y-auto p-4 md:p-6 bg-slate-50 relative">

        <div id="home" class="page-section active max-w-4xl mx-auto text-center pt-10">
            <h1 class="text-4xl font-bold text-slate-800 mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h1>
            <p class="text-slate-600 mb-8">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Sales Funnel ‡∏à‡∏≤‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏à‡∏£‡∏¥‡∏á ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏™‡∏π‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                <div onclick="navigateTo('learning')" class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition cursor-pointer border border-slate-100">
                    <div class="text-4xl mb-3">üìö</div>
                    <h3 class="text-xl font-bold mb-2">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
                    <p class="text-sm text-gray-500">Case Size, Issued Rate ‡πÅ‡∏•‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>
                </div>
                <div onclick="navigateTo('training')" class="bg-indigo-600 text-white p-6 rounded-xl shadow hover:shadow-lg transition cursor-pointer hover:bg-indigo-700">
                    <div class="text-4xl mb-3">üèãÔ∏è‚Äç‚ôÄÔ∏è</div>
                    <h3 class="text-xl font-bold mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô (Training)</h3>
                    <p class="text-sm text-indigo-100">‡∏£‡∏±‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å AI Coach</p>
                </div>
            </div>
        </div>

        <div id="learning" class="page-section max-w-4xl mx-auto">
            <button onclick="navigateTo('home')" class="mb-4 text-sm text-gray-500 hover:text-indigo-600">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <h2 class="text-2xl font-bold mb-6">üìö ‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h2>
            <div class="space-y-4">
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <h3 class="font-bold text-lg text-indigo-700 mb-2">1. Case Size (‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)</h3>
                    <p class="text-gray-600 mb-2">‡∏Ñ‡∏∑‡∏≠ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏£‡∏≤‡∏Ç‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà</p>
                    <code class="bg-gray-100 p-2 rounded block w-full text-center">Case Size = ‡∏ú‡∏•‡∏á‡∏≤‡∏ô APE ‡∏£‡∏ß‡∏° (‡∏≠‡∏î‡∏µ‡∏ï) √∑ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏ß‡∏° (‡∏≠‡∏î‡∏µ‡∏ï)</code>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <h3 class="font-bold text-lg text-indigo-700 mb-2">2. Issued Rate vs Submitted</h3>
                    <p class="text-gray-600 mb-2">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (Submit) ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Issued) ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
                    <code class="bg-gray-100 p-2 rounded block w-full text-center">APE Submitted = ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ APE Issued √∑ (Issued Rate % / 100)</code>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border">
                    <h3 class="font-bold text-lg text-indigo-700 mb-2">3. Conversion Rate (‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•)</h3>
                    <p class="text-gray-600">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πà‡∏á‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏≤‡∏Ñ‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏≤‡∏Å‡πÇ‡∏ó‡∏£‡∏ô‡∏±‡∏î -> ‡∏ô‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà %</p>
                </div>
            </div>
        </div>

        <div id="training" class="page-section max-w-5xl mx-auto pb-20">
            
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">üèãÔ∏è Training Simulator</h2>
                    <p class="text-sm text-slate-500">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô</p>
                </div>
                <button onclick="generateScenario()" class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 text-sm font-medium">
                    üîÑ ‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <div class="lg:col-span-4 space-y-4">
                    <div class="bg-indigo-900 text-white p-6 rounded-xl shadow-lg relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">üéØ</div>
                        <h3 class="text-indigo-200 text-xs font-bold uppercase tracking-wider mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏à‡∏ó‡∏¢‡πå (Scenario)</h3>
                        
                        <div class="mb-4">
                            <label class="text-xs text-indigo-300 block">1. ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ APE (Issued)</label>
                            <div class="text-3xl font-bold" id="scen-target">---</div>
                        </div>

                        <div class="mb-4 p-3 bg-indigo-800 rounded-lg">
                            <label class="text-xs text-indigo-300 block mb-1">2. ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï (Performance)</label>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Total APE:</span>
                                <span class="font-mono" id="scen-past-ape">---</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>Total Cases:</span>
                                <span class="font-mono" id="scen-past-count">---</span>
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-indigo-300 block">3. ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏á‡∏≤‡∏ô (Quality)</label>
                            <div class="flex justify-between items-end">
                                <span>Issued Rate:</span>
                                <span class="text-2xl font-bold text-green-400" id="scen-issue-rate">---%</span>
                            </div>
                        </div>
                    </div>

                    <div id="feedback-box" class="hidden bg-white border-l-4 border-yellow-400 p-4 rounded-r-xl shadow-sm">
                        <h4 class="font-bold text-gray-800 flex items-center gap-2">ü§ñ AI Coach Analysis</h4>
                        <p class="text-sm text-gray-600 mt-2 leading-relaxed" id="feedback-text"></p>
                    </div>
                </div>

                <div class="lg:col-span-8 space-y-6">
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <span class="bg-gray-800 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span> 
                            ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Foundation)
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Case Size ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ö‡∏≤‡∏ó/‡∏£‡∏≤‡∏¢)</label>
                                <input type="number" id="inp-case-size" class="w-full border border-gray-300 rounded-lg p-2.5 transition-colors" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏≠‡∏î‡∏µ‡∏ï..." onkeyup="checkPart1()">
                                <p class="text-xs text-gray-400 mt-1">(Hint: Past APE √∑ Past Cases)</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ APE Submitted (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="inp-ape-submit" class="w-full border border-gray-300 rounded-lg p-2.5 transition-colors" placeholder="‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà..." onkeyup="checkPart1()">
                                <p class="text-xs text-gray-400 mt-1">(Hint: Target √∑ Issued Rate)</p>
                            </div>
                        </div>
                    </div>

                    <div id="part2-container" class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 pointer-events-none transition-opacity">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <span class="bg-gray-800 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span> 
                            ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô Funnel (Reverse Engineering)
                        </h3>
                        <p class="text-sm text-gray-500 mb-4">‡∏à‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î Conversion Rate ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á</p>

                        <div class="space-y-4">
                            
                            <div class="flex items-center gap-3">
                                <div class="w-24 text-right text-sm font-bold text-green-600">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                                <input type="number" id="f-closed" class="w-24 border rounded p-2 text-center font-bold" placeholder="‡∏£‡∏≤‡∏¢" onkeyup="checkPart2()">
                                <span class="text-sm text-gray-400">‡∏£‡∏≤‡∏¢ (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å APE Submit √∑ Case Size)</span>
                            </div>

                            <div class="flex items-center gap-3 pl-24 py-1">
                                <div class="h-6 w-0.5 bg-gray-300"></div>
                                <div class="text-xs bg-gray-100 px-2 py-1 rounded border flex gap-2 items-center">
                                    Closing Rate %: <input type="number" id="r-close" value="50" class="w-10 bg-transparent text-center border-b border-gray-400 focus:outline-none font-bold text-indigo-600" onchange="checkPart2()">
                                </div>
                            </div>

                            <div class="flex items-center gap-3">
                                <div class="w-24 text-right text-sm font-bold text-gray-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö/‡πÄ‡∏™‡∏ô‡∏≠</div>
                                <input type="number" id="f-present" class="w-24 border rounded p-2 text-center" placeholder="‡∏£‡∏≤‡∏¢" onkeyup="checkPart2()">
                            </div>

                             <div class="flex items-center gap-3 pl-24 py-1">
                                <div class="h-6 w-0.5 bg-gray-300"></div>
                                <div class="text-xs bg-gray-100 px-2 py-1 rounded border flex gap-2 items-center">
                                    Show Up Rate %: <input type="number" id="r-show" value="70" class="w-10 bg-transparent text-center border-b border-gray-400 focus:outline-none font-bold text-indigo-600" onchange="checkPart2()">
                                </div>
                            </div>

                            <div class="flex items-center gap-3">
                                <div class="w-24 text-right text-sm font-bold text-gray-700">‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏î‡πâ</div>
                                <input type="number" id="f-met" class="w-24 border rounded p-2 text-center" placeholder="‡∏£‡∏≤‡∏¢" onkeyup="checkPart2()">
                            </div>

                            <div class="flex items-center gap-3 pl-24 py-1">
                                <div class="h-6 w-0.5 bg-gray-300"></div>
                                <div class="text-xs bg-gray-100 px-2 py-1 rounded border flex gap-2 items-center">
                                    Appt Rate %: <input type="number" id="r-appt" value="30" class="w-10 bg-transparent text-center border-b border-gray-400 focus:outline-none font-bold text-indigo-600" onchange="checkPart2()">
                                </div>
                            </div>

                            <div class="flex items-center gap-3">
                                <div class="w-24 text-right text-sm font-bold text-gray-700">‡πÇ‡∏ó‡∏£/‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
                                <input type="number" id="f-call" class="w-24 border rounded p-2 text-center" placeholder="‡∏™‡∏≤‡∏¢" onkeyup="checkPart2()">
                            </div>

                             <div class="flex items-center gap-3 pl-24 py-1">
                                <div class="h-6 w-0.5 bg-gray-300"></div>
                                <div class="text-xs bg-gray-100 px-2 py-1 rounded border flex gap-2 items-center">
                                    Contact Rate %: <input type="number" id="r-contact" value="50" class="w-10 bg-transparent text-center border-b border-gray-400 focus:outline-none font-bold text-indigo-600" onchange="checkPart2()">
                                </div>
                            </div>

                            <div class="flex items-center gap-3">
                                <div class="w-24 text-right text-sm font-bold text-gray-700">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (Lead)</div>
                                <input type="number" id="f-lead" class="w-24 border rounded p-2 text-center bg-blue-50" placeholder="‡∏£‡∏≤‡∏¢" onkeyup="checkPart2()">
                                <span class="text-xs text-blue-600" id="lead-suggestion"></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // State Management
        let scenario = {};
        let part1Solved = false;

        function navigateTo(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if(pageId === 'training' && !scenario.targetAPE) generateScenario();
        }

        function generateScenario() {
            // Random Logic
            const target = Math.round((Math.random() * 500000 + 100000) / 10000) * 10000; // 100k - 600k
            const caseCount = Math.floor(Math.random() * 20) + 10; // 10 - 30 cases
            const avgCaseSize = Math.round((Math.random() * 40000 + 20000) / 1000) * 1000; // 20k - 60k
            const pastAPE = avgCaseSize * caseCount;
            const issuedRate = Math.floor(Math.random() * 4 + 6) * 10; // 60, 70, 80, 90%

            scenario = {
                target: target,
                pastAPE: pastAPE,
                pastCount: caseCount,
                avgCaseSize: avgCaseSize,
                issuedRate: issuedRate,
                apeSubmit: Math.round(target / (issuedRate/100))
            };

            // Render UI
            document.getElementById('scen-target').innerText = scenario.target.toLocaleString();
            document.getElementById('scen-past-ape').innerText = scenario.pastAPE.toLocaleString();
            document.getElementById('scen-past-count').innerText = scenario.pastCount + " ‡∏£‡∏≤‡∏¢";
            document.getElementById('scen-issue-rate').innerText = scenario.issuedRate + "%";

            // Reset Fields
            resetInputs();
        }

        function resetInputs() {
            document.querySelectorAll('input').forEach(i => {
                if(!i.id.startsWith('r-')) { // Don't reset rates
                    i.value = '';
                    i.classList.remove('valid-field', 'invalid-field');
                }
            });
            document.getElementById('part2-container').classList.add('opacity-50', 'pointer-events-none');
            document.getElementById('feedback-box').classList.add('hidden');
            part1Solved = false;
        }

        function checkPart1() {
            const userSize = parseFloat(document.getElementById('inp-case-size').value);
            const userSubmit = parseFloat(document.getElementById('inp-ape-submit').value);
            
            let sizeCorrect = false;
            let submitCorrect = false;

            // Check Case Size (Allow 5% margin due to rounding user might do)
            if(userSize) {
                const el = document.getElementById('inp-case-size');
                if(Math.abs(userSize - scenario.avgCaseSize) < 1000) {
                    el.classList.add('valid-field');
                    el.classList.remove('invalid-field');
                    sizeCorrect = true;
                } else {
                    el.classList.add('invalid-field');
                    el.classList.remove('valid-field');
                }
            }

            // Check APE Submit
            if(userSubmit) {
                const el = document.getElementById('inp-ape-submit');
                // Allow small error margin
                if(Math.abs(userSubmit - scenario.apeSubmit) < 5000) {
                    el.classList.add('valid-field');
                    el.classList.remove('invalid-field');
                    submitCorrect = true;
                } else {
                    el.classList.add('invalid-field');
                    el.classList.remove('valid-field');
                }
            }

            if(sizeCorrect && submitCorrect) {
                part1Solved = true;
                document.getElementById('part2-container').classList.remove('opacity-50', 'pointer-events-none');
            }
        }

        function checkPart2() {
            if(!part1Solved) return;

            // Get Values
            const nClose = parseInt(document.getElementById('f-closed').value) || 0;
            const nPres = parseInt(document.getElementById('f-present').value) || 0;
            const nMet = parseInt(document.getElementById('f-met').value) || 0;
            const nCall = parseInt(document.getElementById('f-call').value) || 0;
            const nLead = parseInt(document.getElementById('f-lead').value) || 0;

            const rClose = parseInt(document.getElementById('r-close').value) / 100;
            const rShow = parseInt(document.getElementById('r-show').value) / 100;
            const rAppt = parseInt(document.getElementById('r-appt').value) / 100;
            const rContact = parseInt(document.getElementById('r-contact').value) / 100;

            // 1. Validate Target Volume (Closed Cases vs APE Submit)
            const requiredCases = Math.ceil(scenario.apeSubmit / scenario.avgCaseSize);
            validateField('f-closed', nClose >= requiredCases);

            // 2. Validate Step Math (Forward Check with tolerance)
            // Present -> Closed
            const expectedClosed = Math.round(nPres * rClose);
            validateField('f-present', Math.abs(nClose - expectedClosed) <= 1 && nPres > 0);

            // Met -> Present
            const expectedPres = Math.round(nMet * rShow);
            validateField('f-met', Math.abs(nPres - expectedPres) <= 1 && nMet > 0);

            // Call -> Met
            const expectedMet = Math.round(nCall * rAppt);
            validateField('f-call', Math.abs(nMet - expectedMet) <= 1 && nCall > 0);

            // Lead -> Call
            const expectedCall = Math.round(nLead * rContact);
            validateField('f-lead', Math.abs(nCall - expectedCall) <= 2 && nLead > 0);

            // 3. AI Coach Feedback
            generateFeedback(nLead, nClose, {rClose, rShow, rAppt, rContact});
        }

        function validateField(id, condition) {
            const el = document.getElementById(id);
            if(el.value === '') {
                el.classList.remove('valid-field', 'invalid-field');
                return;
            }
            if(condition) {
                el.classList.add('valid-field');
                el.classList.remove('invalid-field');
            } else {
                el.classList.add('invalid-field');
                el.classList.remove('valid-field');
            }
        }

        function generateFeedback(leads, closed, rates) {
            const box = document.getElementById('feedback-box');
            const txt = document.getElementById('feedback-text');
            
            if(leads === 0 || closed === 0) {
                box.classList.add('hidden');
                return;
            }
            box.classList.remove('hidden');

            // Find Weakest Link
            let ratesArr = [
                {name: "Contact Rate", val: rates.rContact},
                {name: "Appt Rate", val: rates.rAppt},
                {name: "Show Up Rate", val: rates.rShow},
                {name: "Closing Rate", val: rates.rClose}
            ];
            ratesArr.sort((a,b) => a.val - b.val);
            let weakest = ratesArr[0];

            // Calculate hypothetical savings
            // If we improve weakest by 10% absolute (e.g. 0.3 -> 0.4)
            // Current Funnel Efficiency = r1*r2*r3*r4
            let currentEff = rates.rContact * rates.rAppt * rates.rShow * rates.rClose;
            
            // New Efficiency
            let newEff = currentEff * ((weakest.val + 0.1) / weakest.val);
            let neededLeadsCurrent = closed / currentEff;
            let neededLeadsNew = closed / newEff;
            let savedLeads = Math.round(neededLeadsCurrent - neededLeadsNew);

            txt.innerHTML = `
                ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ <b>${weakest.name}</b> (${(weakest.val*100).toFixed(0)}%)<br>
                üí° ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å 10% (‡πÄ‡∏õ‡πá‡∏ô ${(weakest.val*100 + 10).toFixed(0)}%) <br>
                ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏´‡∏≤ Lead ‡∏•‡∏î‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <b class="text-green-600">${savedLeads} ‡∏£‡∏≤‡∏¢</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°!
            `;
        }

        // Init
        // generateScenario(); // Call on load if needed
    </script>
</body>
</html>
